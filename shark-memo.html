<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¯Šé­šå®¶åº­å”ä½œå‚™å¿˜éŒ„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Firebase SDK Setup -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ğŸ”´ğŸ”´ğŸ”´ è«‹æŠŠé€™è£¡æ›æˆä½ å‰›å‰›åœ¨ Firebase è¤‡è£½çš„è¨­å®š ğŸ”´ğŸ”´ğŸ”´
        const firebaseConfig = {
           apiKey: "AIzaSyC2dr6HshQLNIDvu1zi4_teha9fh4AJF7M",
           authDomain: "shark-memo.firebaseapp.com",
           projectId: "shark-memo",
           storageBucket: "shark-memo.firebasestorage.app",
           messagingSenderId: "235326209584",
           appId: "1:235326209584:web:6ded68d8886e7906a777f5"

        };
        // ğŸ”´ğŸ”´ğŸ”´ è¨­å®šçµæŸ ğŸ”´ğŸ”´ğŸ”´

        // åˆå§‹åŒ– Firebase
        try {
            const app = initializeApp(firebaseConfig);
            window.auth = getAuth(app);
            window.db = getFirestore(app);
            window.signInAnonymously = signInAnonymously;
            window.doc = doc;
            window.onSnapshot = onSnapshot;
            window.setDoc = setDoc;
            console.log("Firebase initialized");
        } catch (e) {
            console.error("Firebase è¨­å®šæœ‰èª¤ï¼Œè«‹æª¢æŸ¥ç¨‹å¼ç¢¼", e);
            document.body.innerHTML = "<h1 style='text-align:center; margin-top:50px;'>è¨­å®šéŒ¯èª¤ï¼šè«‹æª¢æŸ¥ index.html ä¸­çš„ firebaseConfig</h1>";
        }
    </script>
    
    <style>
        body { font-family: 'Zen Maru Gothic', sans-serif; background-color: #f0f9ff; overflow: hidden; transition: background-color 0.5s; }
        body.mom-theme { background-color: #fff0f5; }
        @keyframes float { 0%, 100% { transform: translateY(0px) rotate(0deg); } 50% { transform: translateY(-8px) rotate(2deg); } }
        .shark-float { animation: float 5s ease-in-out infinite; }
        @keyframes happy-jump { 0% { transform: translateY(0) scale(1); } 50% { transform: translateY(-20px) scale(1.1) rotate(5deg); } 100% { transform: translateY(0) scale(1); } }
        .shark-happy { animation: happy-jump 0.6s ease-out; }
        @keyframes panic { 0% { transform: translate(1px, 1px) rotate(0deg); } 20% { transform: translate(-3px, 0px) rotate(1deg); } 40% { transform: translate(1px, -1px) rotate(1deg); } 60% { transform: translate(-3px, 1px) rotate(0deg); } 80% { transform: translate(-1px, -1px) rotate(1deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }
        .shark-panic { animation: panic 0.5s infinite; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 10px; }
        .glass-panel { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.5); }
    </style>
</head>
<body class="h-screen w-full flex items-center justify-center relative text-gray-700">

    <div id="loading" class="fixed inset-0 z-50 bg-white flex items-center justify-center transition-opacity duration-500">
        <div class="text-center">
            <i class="fas fa-spinner fa-spin text-4xl text-blue-400 mb-2"></i>
            <p class="text-blue-400 font-bold">é¯Šé­šé€£ç·šä¸­...</p>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="fixed inset-0 z-40 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-[2rem] p-8 shadow-2xl text-center">
            <h2 class="text-2xl font-bold text-gray-700 mb-2">æ­¡è¿å›å®¶ï¼</h2>
            <p class="text-gray-400 text-sm mb-6">ä½ æ˜¯èª°å‘¢ï¼Ÿ</p>
            <div class="flex gap-4 mb-6">
                <button onclick="selectRole('dad')" id="btn-dad" class="flex-1 p-4 rounded-2xl border-4 border-transparent hover:border-blue-200 bg-blue-50 transition-all group">
                    <div class="text-4xl mb-2 group-hover:scale-110 transition-transform">ğŸ‘”</div><div class="font-bold text-blue-600">é¯Šå°çˆ¸çˆ¸</div>
                </button>
                <button onclick="selectRole('mom')" id="btn-mom" class="flex-1 p-4 rounded-2xl border-4 border-transparent hover:border-pink-200 bg-pink-50 transition-all group">
                    <div class="text-4xl mb-2 group-hover:scale-110 transition-transform">ğŸ€</div><div class="font-bold text-pink-500">é¯Šå°åª½åª½</div>
                </button>
            </div>
            <div class="mb-6">
                <label class="block text-left text-xs font-bold text-gray-400 ml-1 mb-1">å®¶åº­ä»£ç¢¼ (å’Œå®¶äººè¼¸å…¥ä¸€æ¨£çš„)</label>
                <input type="text" id="room-code-input" placeholder="ä¾‹å¦‚: LOVE123" class="w-full bg-gray-100 rounded-xl px-4 py-3 font-bold text-center uppercase tracking-widest focus:outline-none focus:ring-2 focus:ring-blue-300">
            </div>
            <button onclick="confirmLogin()" class="w-full bg-gray-800 text-white font-bold py-3 rounded-xl shadow-lg hover:bg-black transition disabled:opacity-50" id="login-confirm-btn" disabled>é–‹å§‹ä½¿ç”¨</button>
        </div>
    </div>

    <!-- Main App -->
    <div id="app-container" class="glass-panel w-full max-w-md h-[92vh] rounded-[30px] shadow-2xl flex flex-col relative overflow-hidden hidden transform transition-all duration-500 scale-95 opacity-0">
        <div id="app-header" class="bg-blue-500 p-6 pb-12 rounded-t-[30px] relative shrink-0 text-center transition-colors duration-500">
            <div class="absolute top-4 left-4 text-white/80 text-xs font-bold bg-white/20 px-2 py-1 rounded-lg"><i class="fas fa-home mr-1"></i> <span id="room-display">...</span></div>
            <button onclick="logout()" class="absolute top-4 right-4 text-white/80 hover:text-white transition"><i class="fas fa-sign-out-alt"></i></button>
            <div class="relative mt-4">
                <div id="shark-bubble" class="bg-white text-gray-700 px-4 py-2 rounded-2xl shadow-lg text-sm font-bold inline-block mb-2 animate-bounce">ä»Šå¤©ä¹Ÿè¦åŠ æ²¹å–”ï¼</div>
                <div id="shark-container" class="w-36 h-36 mx-auto shark-float cursor-pointer relative z-10 filter drop-shadow-xl" onclick="touchShark()">
                    <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                        <path d="M100 30 C 50 30, 10 80, 10 140 C 10 190, 50 205, 100 205 C 150 205, 190 190, 190 140 C 190 80, 150 30, 100 30" fill="currentColor" class="text-shark-body transition-colors duration-500" style="color: inherit"/>
                        <path d="M100 80 C 70 80, 40 110, 40 150 C 40 190, 70 200, 100 200 C 130 200, 160 190, 160 150 C 160 110, 130 80, 100 80" fill="#ffffff"/>
                        <g id="face-normal"><circle cx="70" cy="110" r="8" fill="black"/><circle cx="130" cy="110" r="8" fill="black"/><circle cx="72" cy="108" r="3" fill="white"/><circle cx="132" cy="108" r="3" fill="white"/><path d="M85 150 Q 100 160 115 150" stroke="black" stroke-width="3" fill="none" stroke-linecap="round"/></g>
                        <g id="acc-dad" class="hidden"><path d="M100 160 L 90 200 L 100 210 L 110 200 Z" fill="#1e3a8a"/> <rect x="95" y="160" width="10" height="5" fill="#1e3a8a"/></g>
                        <g id="acc-mom" class="hidden"><path d="M130 50 Q 140 30 150 50 Q 140 70 130 50" fill="#ec4899"/><path d="M130 50 Q 120 30 110 50 Q 120 70 130 50" fill="#ec4899"/><circle cx="130" cy="50" r="5" fill="#be185d"/></g>
                        <path d="M10 140 Q -10 120 20 110" fill="currentColor" class="text-shark-body transition-colors duration-500" style="color: inherit"/><path d="M190 140 Q 210 120 180 110" fill="currentColor" class="text-shark-body transition-colors duration-500" style="color: inherit"/>
                    </svg>
                </div>
            </div>
        </div>

        <div class="px-6 -mt-8 relative z-20">
            <div class="bg-white rounded-2xl shadow-lg p-3 flex flex-col gap-2 border border-blue-50">
                <input type="text" id="task-input" placeholder="è¼¸å…¥è¦åšçš„å®¶å‹™..." class="w-full text-gray-700 font-bold placeholder-gray-300 outline-none bg-transparent">
                <div class="flex items-center justify-between border-t border-gray-100 pt-2">
                    <div class="flex items-center gap-2 bg-gray-50 px-3 py-1.5 rounded-lg cursor-pointer hover:bg-gray-100 transition" onclick="document.getElementById('task-date').showPicker()">
                        <i class="far fa-clock text-gray-400"></i><input type="datetime-local" id="task-date" class="bg-transparent border-none outline-none w-24 text-xs text-gray-500">
                    </div>
                    <button onclick="addTask()" id="add-btn" class="bg-gray-800 text-white w-10 h-10 rounded-xl flex items-center justify-center shadow-md active:scale-95 transition-transform hover:bg-black"><i class="fas fa-plus"></i></button>
                </div>
            </div>
        </div>

        <div class="flex-1 overflow-y-auto px-6 py-4 space-y-3 custom-scroll" id="task-list"></div>

        <div class="p-4 bg-white/90 border-t border-gray-100 flex justify-between items-center px-8 text-xs font-bold">
            <div class="flex items-center gap-2 text-blue-600"><span class="text-lg">ğŸ‘”</span><span id="score-dad">0</span></div>
            <div class="text-gray-300">VS</div>
            <div class="flex items-center gap-2 text-pink-500"><span id="score-mom">0</span><span class="text-lg">ğŸ€</span></div>
        </div>
    </div>

    <div id="edit-modal" class="fixed inset-0 z-50 bg-black/40 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-xs rounded-3xl p-6 shadow-2xl">
            <h3 class="text-lg font-bold text-gray-800 mb-4 text-center">ä¿®æ”¹ä»»å‹™</h3>
            <input type="text" id="edit-text" class="w-full bg-gray-50 border rounded-xl px-4 py-3 mb-4 font-bold outline-none focus:border-blue-400">
            <input type="datetime-local" id="edit-date" class="w-full bg-gray-50 border rounded-xl px-4 py-3 mb-6 outline-none focus:border-blue-400">
            <div class="flex gap-2"><button onclick="closeEditModal()" class="flex-1 py-3 text-gray-400 font-bold hover:bg-gray-50 rounded-xl">å–æ¶ˆ</button><button onclick="saveEdit()" class="flex-1 py-3 bg-blue-500 text-white font-bold rounded-xl shadow-lg hover:bg-blue-600">å„²å­˜</button></div>
        </div>
    </div>

    <script>
        let currentUser = null; let tasks = []; let unsubscribe = null; let editingId = null;
        const THEME = { dad: { bg: '#0058a3', body: '#e0f2fe', text: '#1e3a8a' }, mom: { bg: '#db2777', body: '#fff0f5', text: '#9d174d' } };

        window.addEventListener('load', async () => {
            const checkFirebase = setInterval(async () => {
                if (window.auth && window.db) {
                    clearInterval(checkFirebase);
                    try {
                        await window.signInAnonymously(window.auth);
                        console.log("Logged in anonymously");
                    } catch (e) { console.error("Auth Error", e); alert("é€£ç·šéŒ¯èª¤: è«‹æª¢æŸ¥ Firebase è¨­å®š"); }

                    const savedRole = localStorage.getItem('shark_family_role');
                    const savedRoom = localStorage.getItem('shark_family_room');
                    document.getElementById('loading').classList.add('opacity-0', 'pointer-events-none');
                    if (savedRole && savedRoom) login(savedRole, savedRoom);
                }
            }, 500);
        });

        function selectRole(role) {
            currentUser = { role: role, room: '' };
            document.getElementById('btn-dad').classList.remove('ring-4', 'ring-blue-300');
            document.getElementById('btn-mom').classList.remove('ring-4', 'ring-pink-300');
            if (role === 'dad') document.getElementById('btn-dad').classList.add('ring-4', 'ring-blue-300');
            if (role === 'mom') document.getElementById('btn-mom').classList.add('ring-4', 'ring-pink-300');
            checkLoginReady();
        }

        document.getElementById('room-code-input').addEventListener('input', checkLoginReady);
        function checkLoginReady() {
            const code = document.getElementById('room-code-input').value.trim();
            const btn = document.getElementById('login-confirm-btn');
            if (currentUser && currentUser.role && code.length >= 3) { btn.disabled = false; currentUser.room = code.toUpperCase(); } else { btn.disabled = true; }
        }

        function confirmLogin() { if (currentUser && currentUser.role && currentUser.room) { localStorage.setItem('shark_family_role', currentUser.role); localStorage.setItem('shark_family_room', currentUser.room); login(currentUser.role, currentUser.room); } }

        function login(role, room) {
            currentUser = { role, room };
            document.getElementById('login-modal').classList.add('hidden');
            const app = document.getElementById('app-container');
            app.classList.remove('hidden');
            setTimeout(() => { app.classList.remove('scale-95', 'opacity-0'); app.classList.add('scale-100', 'opacity-100'); }, 100);
            applyTheme(role);
            document.getElementById('room-display').textContent = room;
            subscribeRoom(room);
        }

        function logout() { localStorage.removeItem('shark_family_role'); localStorage.removeItem('shark_family_room'); location.reload(); }

        function applyTheme(role) {
            const header = document.getElementById('app-header');
            const sharkContainer = document.getElementById('shark-container');
            const addBtn = document.getElementById('add-btn');
            document.getElementById('acc-dad').classList.add('hidden');
            document.getElementById('acc-mom').classList.add('hidden');
            if (role === 'dad') {
                header.className = "bg-blue-600 p-6 pb-12 rounded-t-[30px] relative shrink-0 text-center transition-colors duration-500";
                sharkContainer.style.color = "#0058a3";
                document.getElementById('acc-dad').classList.remove('hidden');
                document.body.className = "h-screen w-full flex items-center justify-center relative text-gray-700";
                addBtn.className = "bg-blue-600 text-white w-10 h-10 rounded-xl flex items-center justify-center shadow-md active:scale-95 transition-transform hover:bg-blue-700";
            } else {
                header.className = "bg-pink-500 p-6 pb-12 rounded-t-[30px] relative shrink-0 text-center transition-colors duration-500";
                sharkContainer.style.color = "#ec4899";
                document.getElementById('acc-mom').classList.remove('hidden');
                document.body.className = "mom-theme h-screen w-full flex items-center justify-center relative text-gray-700";
                addBtn.className = "bg-pink-500 text-white w-10 h-10 rounded-xl flex items-center justify-center shadow-md active:scale-95 transition-transform hover:bg-pink-600";
            }
        }

        function subscribeRoom(roomId) {
            if (!window.db) return;
            // ç¨ç«‹ç‰ˆç›´æ¥ä½¿ç”¨ user æä¾›çš„ collection åç¨±ï¼Œé€™è£¡é è¨­ shark_family_data
            const docRef = window.doc(window.db, 'shark_family_data', roomId);
            unsubscribe = window.onSnapshot(docRef, (snap) => {
                if (snap.exists()) { tasks = snap.data().tasks || []; } else { tasks = []; }
                renderTasks(); checkUrgency();
            }, (error) => { console.error("Sync Error:", error); if (error.code === 'permission-denied') alert("æ¬Šé™éŒ¯èª¤ï¼šè«‹æª¢æŸ¥ Firestore è¦å‰‡æ˜¯å¦è¨­å®šç‚ºæ¸¬è©¦æ¨¡å¼ (Test Mode)"); });
        }

        async function syncTasks() {
            if (!currentUser || !currentUser.room || !window.db) return;
            const docRef = window.doc(window.db, 'shark_family_data', currentUser.room);
            try { await window.setDoc(docRef, { tasks: tasks, lastUpdated: Date.now() }); } catch (e) { console.error("Save Error", e); }
        }

        function addTask() {
            const input = document.getElementById('task-input');
            const dateInput = document.getElementById('task-date');
            const text = input.value.trim();
            if (!text) { sharkSay("è«‹è¼¸å…¥å®¶å‹™å…§å®¹å–”ï¼"); return; }
            const newTask = { id: Date.now().toString(), text: text, time: dateInput.value, completed: false, completedBy: null, creator: currentUser.role };
            tasks.unshift(newTask); syncTasks();
            input.value = ''; dateInput.value = '';
            sharkAnim('happy'); sharkSay("æ”¶åˆ°ï¼æˆ‘å€‘ä¸€èµ·å®Œæˆï¼");
        }

        function toggleTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.completed = !task.completed;
                if (task.completed) {
                    task.completedBy = currentUser.role;
                    sharkAnim('happy');
                    sharkSay(currentUser.role === 'dad' ? "çˆ¸çˆ¸å¥½æ£’ï¼" : "åª½åª½è¾›è‹¦äº†ï¼");
                    confetti({ particleCount: 50, spread: 60, origin: { y: 0.7 } });
                } else { task.completedBy = null; }
                syncTasks();
            }
        }

        function deleteTask(id) { if(confirm("ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ")) { tasks = tasks.filter(t => t.id !== id); syncTasks(); } }

        function openEditModal(id) {
            const task = tasks.find(t => t.id === id); if(!task) return;
            editingId = id;
            document.getElementById('edit-text').value = task.text;
            document.getElementById('edit-date').value = task.time;
            document.getElementById('edit-modal').classList.remove('hidden');
        }
        function closeEditModal() { document.getElementById('edit-modal').classList.add('hidden'); editingId = null; }
        function saveEdit() {
            if (!editingId) return;
            const task = tasks.find(t => t.id === editingId);
            if (task) { task.text = document.getElementById('edit-text').value; task.time = document.getElementById('edit-date').value; syncTasks(); closeEditModal(); }
        }

        function renderTasks() {
            const list = document.getElementById('task-list'); list.innerHTML = '';
            let dadScore = 0; let momScore = 0;
            const sortedTasks = [...tasks].sort((a, b) => { if (a.completed === b.completed) { if (a.time && b.time) return new Date(a.time) - new Date(b.time); return b.id - a.id; } return a.completed ? 1 : -1; });

            if (sortedTasks.length === 0) { list.innerHTML = `<div class="text-center text-gray-300 mt-10"><i class="fas fa-couch text-5xl mb-4"></i><p>å®¶å‹™æ¸…ç©ºäº†ï¼ä¼‘æ¯ä¸€ä¸‹å§ï½</p></div>`; }
            const now = new Date();
            sortedTasks.forEach(task => {
                if (task.completed && task.completedBy === 'dad') dadScore++;
                if (task.completed && task.completedBy === 'mom') momScore++;
                let timeTag = ''; let isUrgent = false;
                if (task.time && !task.completed) {
                    const due = new Date(task.time);
                    const diffHrs = (due - now) / 36e5;
                    const dateStr = due.toLocaleDateString('zh-TW', {month:'numeric', day:'numeric'}) + ' ' + due.toLocaleTimeString('zh-TW', {hour:'2-digit', minute:'2-digit'});
                    if (due < now) { timeTag = `<span class="text-red-500 font-bold text-xs bg-red-50 px-2 py-0.5 rounded ml-2">éæœŸ</span>`; } 
                    else if (diffHrs < 3) { isUrgent = true; timeTag = `<span class="text-orange-500 font-bold text-xs bg-orange-50 px-2 py-0.5 rounded ml-2 animate-pulse">æ€¥</span>`; } 
                    else { timeTag = `<span class="text-gray-400 text-xs ml-2">${dateStr}</span>`; }
                }
                const creatorIcon = task.creator === 'dad' ? 'ğŸ‘”' : (task.creator === 'mom' ? 'ğŸ€' : '');
                let completedByBadge = '';
                if (task.completed && task.completedBy) { completedByBadge = task.completedBy === 'dad' ? `<span class="text-[10px] bg-blue-100 text-blue-600 px-2 py-0.5 rounded-full ml-2">çˆ¸çˆ¸å®Œæˆ</span>` : `<span class="text-[10px] bg-pink-100 text-pink-500 px-2 py-0.5 rounded-full ml-2">åª½åª½å®Œæˆ</span>`; }
                const div = document.createElement('div');
                div.className = `flex items-center p-4 bg-white rounded-2xl shadow-sm border transition-all ${task.completed ? 'opacity-60 border-gray-100' : (isUrgent ? 'border-orange-200' : 'border-blue-50 hover:border-blue-200')}`;
                div.innerHTML = `<button onclick="toggleTask('${task.id}')" class="text-xl mr-3 ${task.completed ? 'text-green-500' : 'text-gray-200 hover:text-blue-400'}"><i class="${task.completed ? 'fas fa-check-circle' : 'far fa-circle'}"></i></button><div class="flex-1 min-w-0"><div class="flex items-center"><span class="text-xs mr-1 opacity-50 select-none">${creatorIcon}</span><span class="${task.completed ? 'line-through text-gray-400' : 'text-gray-700 font-bold'} truncate">${escapeHtml(task.text)}</span>${timeTag}</div><div class="h-4">${completedByBadge}</div></div><div class="flex gap-2 opacity-50 hover:opacity-100"><button onclick="openEditModal('${task.id}')" class="w-8 h-8 flex items-center justify-center bg-gray-50 rounded-full hover:bg-gray-100 text-gray-400"><i class="fas fa-pen text-xs"></i></button><button onclick="deleteTask('${task.id}')" class="w-8 h-8 flex items-center justify-center bg-red-50 rounded-full hover:bg-red-100 text-red-300"><i class="fas fa-trash text-xs"></i></button></div>`;
                list.appendChild(div);
            });
            document.getElementById('score-dad').textContent = dadScore; document.getElementById('score-mom').textContent = momScore;
        }

        function sharkSay(msg) { const b = document.getElementById('shark-bubble'); b.innerText = msg; b.classList.remove('animate-bounce'); void b.offsetWidth; b.classList.add('animate-bounce'); }
        function sharkAnim(type) { const s = document.getElementById('shark-container'); s.className = `w-36 h-36 mx-auto shark-${type} cursor-pointer relative z-10 filter drop-shadow-xl`; setTimeout(() => { if (s.className.includes('shark-' + type)) { s.className = 'w-36 h-36 mx-auto shark-float cursor-pointer relative z-10 filter drop-shadow-xl'; } }, 1000); }
        function checkUrgency() { const now = new Date(); const hasUrgent = tasks.some(t => !t.completed && t.time && (new Date(t.time) - now < 3*36e5) && (new Date(t.time) > now)); const s = document.getElementById('shark-container'); if (hasUrgent) { if (!s.classList.contains('shark-panic')) { s.classList.remove('shark-float'); s.classList.add('shark-panic'); sharkSay("æœ‰æ€¥äº‹ï¼å¿«é»è™•ç†ï¼"); } } else { if (s.classList.contains('shark-panic')) { s.classList.remove('shark-panic'); s.classList.add('shark-float'); } } }
        function touchShark() { const msgs = currentUser.role === 'dad' ? ["çˆ¸çˆ¸è¾›è‹¦äº†ï¼", "é ˜å¸¶å¾ˆå¸¥å–”ï¼", "ä»Šå¤©è¦å–å•¤é…’å—ï¼Ÿ"] : ["åª½åª½æœ€æ¼‚äº®ï¼", "ä¼‘æ¯ä¸€ä¸‹å–æ¯èŒ¶ï½", "è´è¶çµå¥½é©åˆä½ ï¼"]; sharkSay(msgs[Math.floor(Math.random() * msgs.length)]); sharkAnim('happy'); }
        function escapeHtml(text) { const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' }; return text.replace(/[&<>"']/g, m => map[m]); }
    </script>
</body>
</html>